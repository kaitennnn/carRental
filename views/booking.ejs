<!DOCTYPE html>
<html lang="zh-HK">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>預約租車 - CarRental</title>
    <link rel="stylesheet" href="stylesheets/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>
<style>
    .page-container {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 20px;
        padding: 20px;
    }

    .left-column {
        display: flex;
        flex-direction: column;
        gap: 20px;
        max-width: 1200px;
        /* 可依需求調整 */
    }

    .right-column {
        position: relative;
    }

    .booking-summary {
        position: sticky;
        top: 80px;
        max-width: 320px;
    }
</style>

<body>
    <nav class="navbar">
        <a href="/" class="logo">CarRental</a>
        <ul class="nav-links">
            <li><a href="/">Home</a></li>
            <li><a href="/car">CarList</a></li>
            <li><a href="/booking">NowBooking</a></li>
            <li class="user-menu">
                <a href="#" class="user-icon">
                    <i class="fas fa-user"></i>
                </a>
                <ul class="dropdown-menu">
                    <li><a href="/login">Login</a></li>
                </ul>
            </li>
        </ul>
    </nav>
    <div class="page-container">
        <div class="left-column">
            <section class="selected-car">
                <div class="car-card">
                    <img src="<%= locals.imageURL %>" class="car-image" onerror="this.src='/images/default-car.jpg'">
                    <div class="car-info">
                        <div class="car-title">
                            <span>
                                <%=locals.brand%>
                            </span>
                            <%= locals.model %>
                        </div>
                        <div class="car-year">
                            <%= locals.year %>Year
                        </div>
                        <div class="car-description">
                            <%= locals.description %>
                        </div>
                        <div class="car-details">
                            <div><strong>Type:</strong>
                                <%= locals.type %>
                            </div>
                            <div><strong>Seats:</strong>
                                <%= locals.seats %>
                            </div>
                            <div><strong>Transmission:</strong>
                                <%= locals.transmission %>
                            </div>
                            <div><strong>Power Source:</strong>
                                <%= locals.powerSource %>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <div class="booking-container">
                <div class="booking-grid">
                    <div class="booking-form-section">
                        <h1>Booking Form</h1>
                        <form class="booking-form" action="/payment" method="get">
                            <input type="hidden" id="carID" name="carID" value="<%=locals.carID%>">
                            <input type="hidden" id="amount" name="amount" value="0">
                            <div class="form-group">
                                <label for="name">Name</label>
                                <input type="text" id="name" name="userName" value="<%=locals.uesrName?uesrName:''%>"
                                    required>
                            </div>
                            <div class="form-group">
                                <label for="phone">phone</label>
                                <input type="tel" id="phone" name="phone" value="<%=locals.phone?phone:''%>" required>
                            </div>
                            <div class="date-range-picker">
                                <div class="form-group">
                                    <label for="date-range">選擇租車日期</label>
                                    <input type="text" id="date-range" name="date-range" placeholder="選擇起始和結束日期"
                                        readonly>
                                    <input type="hidden" id="startdate" name="startDate">
                                    <input type="hidden" id="enddate" name="endDate">
                                </div>
                            </div>
                            <button type="submit" class="submit-button" id="submitBtn">確認預約</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="right-column">
            <div class="booking-summary">
                <h2>預約摘要</h2>
                <div class="car-title">
                    <span>
                        <%=locals.brand%>
                    </span>
                    <%= locals.model %>
                        <div class="rental-details">
                            <div class="detail-item">
                                <span>租借天數：</span>
                                <span id="totalDays">0 Day</span>
                            </div>
                            <div class="detail-item">
                                <span>每日租金：</span>
                                <span id="dailyRate">$<%= locals.dailyRate %></span>
                            </div>
                            <div class="detail-item total">
                                <span>總金額：</span>
                                <span id="totalAmount">$0</span>
                            </div>
                        </div>
                </div>
            </div>
        </div>
    </div>
    <footer>
        <p>&copy; 2024 CarRental. All rights reserved.</p>
    </footer>
</body>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
    function calculateTotal() {
        const startDate = document.getElementById('startdate').value;
        const endDate = document.getElementById('enddate').value;
        if (startDate && endDate) {
            const days = Math.ceil((new Date(endDate) - new Date(startDate)) / (1000 * 60 * 60 * 24)) + 1;
            const dailyRate = <%= locals.dailyRate %>;
            const total = days * dailyRate;
            document.getElementById('totalDays').textContent = `${days} Day`;
            document.getElementById('totalAmount').textContent = `$${total}`;
            document.getElementById('amount').value = total;
        }
    }

    flatpickr("#date-range", {
        mode: "range",
        minDate: "today",
        dateFormat: "Y-m-d",
        disableMobile: true,
        locale: {
            rangeSeparator: " 至 ",
            firstDayOfWeek: 1,
            weekdays: {
                shorthand: ["日", "一", "二", "三", "四", "五", "六"],
                longhand: ["星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六"]
            },

        },
        onChange: function (selectedDates, dateString, instance) {
            if (selectedDates.length === 2) {
                document.getElementById('startdate').value = selectedDates[0].toISOString().split('T')[0];
                document.getElementById('enddate').value = selectedDates[1].toISOString().split('T')[0];
                calculateTotal();
            }
        }
    });

</script>

</html>