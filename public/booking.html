<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>預約租車 - CarRental</title>
    <link rel="stylesheet" href="stylesheets/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/airbnb.css">
</head>
<body>
    <nav class="navbar">
        <div class="logo">CarRental</div>
        <ul class="nav-links">
            <li><a href="index.html">首頁</a></li>
            <li><a href="cars.html">車輛列表</a></li>
            <li><a href="booking.html">立即預約</a></li>
            <li class="user-menu">
                <a href="#" class="user-icon">
                    <i class="fas fa-user"></i>
                </a>
                <ul class="dropdown-menu">
                    <li><a href="login.html">登入</a></li>
                </ul>
            </li>
        </ul>
    </nav>

    <main class="booking-container">
        <div class="booking-grid">
            <div class="booking-form-section">
                <h1>預約表單</h1>
                <form class="booking-form" onsubmit="submitForm(event)">
                    <div class="form-group">
                        <label for="name">姓名</label>
                        <input type="text" id="name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="phone">電話</label>
                        <input type="tel" id="phone" name="phone" required>
                    </div>
                    <div class="form-group">
                        <label for="car-type">車型選擇</label>
                        <select id="car-type" name="car-type" required>
                            <option value="">請選擇車型</option>
                            <option value="camry">Toyota Camry</option>
                            <option value="crv">Honda CR-V</option>
                            <option value="bmw">BMW 320i</option>
                        </select>
                    </div>
                    <div class="date-range-picker">
                        <div class="form-group">
                            <label for="date-range">選擇租車日期</label>
                            <input type="text" id="date-range" placeholder="選擇起始和結束日期" readonly>
                        </div>
                    </div>
                    <button type="submit" class="submit-button">確認預約</button>
                </form>
            </div>

            <div class="booking-summary">
                <h2>預約摘要</h2>
                <div class="selected-car">
                    <div id="carInfo">
                        <p class="notice">請選擇車型</p>
                    </div>
                </div>
                <div class="rental-details">
                    <div class="detail-item">
                        <span>租借天數：</span>
                        <span id="totalDays">0 天</span>
                    </div>
                    <div class="detail-item">
                        <span>每日租金：</span>
                        <span id="dailyRate">$0</span>
                    </div>
                    <div class="detail-item total">
                        <span>總金額：</span>
                        <span id="totalAmount">$0</span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        // Car data
        const carData = {
            camry: { name: 'Toyota Camry', type: '轎車', price: 2000, image: 'https://via.placeholder.com/300x200' },
            crv: { name: 'Honda CR-V', type: 'SUV', price: 2500, image: 'https://via.placeholder.com/300x200' },
            bmw: { name: 'BMW 320i', type: '豪華轎車', price: 3500, image: 'https://via.placeholder.com/300x200' }
        };

        // Update car info when selection changes
        document.getElementById('car-type').addEventListener('change', updateCarInfo);
        
        function updateCarInfo() {
            const selectedCar = document.getElementById('car-type').value;
            const carInfo = document.getElementById('carInfo');
            
            if (selectedCar && carData[selectedCar]) {
                const car = carData[selectedCar];
                carInfo.innerHTML = `
                    <img src="${car.image}" alt="${car.name}">
                    <h3>${car.name}</h3>
                    <p>車型: ${car.type}</p>
                    <p>日租金: $${car.price}</p>
                `;
                document.getElementById('dailyRate').textContent = `$${car.price}`;
                calculateTotal();
            }
        }

        function calculateTotal() {
            const selectedCar = document.getElementById('car-type').value;
            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;
            
            if (selectedCar && startDate && endDate) {
                const days = Math.ceil((new Date(endDate) - new Date(startDate)) / (1000 * 60 * 60 * 24)) + 1;
                const dailyRate = carData[selectedCar].price;
                const total = days * dailyRate;
                
                document.getElementById('totalDays').textContent = `${days} 天`;
                document.getElementById('totalAmount').textContent = `$${total}`;
            }
        }

        flatpickr("#date-range", {
            mode: "range",
            minDate: "today",
            dateFormat: "Y-m-d",
            disableMobile: true,
            locale: {
                rangeSeparator: " 至 ",
                firstDayOfWeek: 1,
                weekdays: {
                    shorthand: ["日", "一", "二", "三", "四", "五", "六"],
                    longhand: ["星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六"]
                },
                months: {
                    shorthand: ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十月", "十二月"],
                    longhand: ["一月", "二月", "三月", "四月", "五月", "六月", "七月", "八月", "九月", "十月", "十月", "十二月"]
                }
            },
            onChange: function(selectedDates) {
                if(selectedDates.length === 2) {
                    document.getElementById('start-date').value = selectedDates[0].toISOString().split('T')[0];
                    document.getElementById('end-date').value = selectedDates[1].toISOString().split('T')[0];
                    calculateTotal();
                }
            }
        });

        function submitForm(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const searchParams = new URLSearchParams(formData);
            window.location.href = `payment.html?${searchParams.toString()}`;
        }

        // 從 URL 獲取預選車型
        window.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const selectedCar = urlParams.get('car');
            
            if (selectedCar && carData[selectedCar]) {
                const carSelect = document.getElementById('car-type');
                carSelect.value = selectedCar;
                updateCarInfo(); // 更新車輛信息顯示
            }
        });
    </script>

    <footer>
        <p>&copy; 2024 CarRental. All rights reserved.</p>
    </footer>
</body>
</html>
