<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>添加車輛 - CarRental</title>
    <link rel="stylesheet" href="stylesheets/style.css">
</head>

<body>
    <nav class="navbar">
        <div class="logo">CarRental</div>
        <ul class="nav-links">
            <li><a href="index.html">首頁</a></li>
            <li><a href="cars.html">車輛列表</a></li>
            <li><a href="add-car.html">添加車輛</a></li>
            <li class="user-menu">
                <a href="#" class="user-icon">
                    <i class="fas fa-user"></i>
                </a>
                <ul class="dropdown-menu">
                    <li><a href="login.html">登入</a></li>
                </ul>
            </li>
        </ul>
    </nav>

    <main class="admin-container">
        <h1>添加新車輛</h1>
        <form class="admin-form" id="add-car-form" enctype="multipart/form-data" action="/cars/add" method="POST">
            <input type="hidden" id="car-id" name="carID">
            <div class="form-group">
                <label for="car-brand">品牌</label>
                <input type="text" id="car-brand" name="brand" placeholder="請輸入品牌" required>
            </div>
            <div class="form-group">
                <label for="car-model">型號</label>
                <input type="text" id="car-model" name="model" placeholder="請輸入型號" required>
            </div>
            <div class="form-group">
                <label for="car-year">年份</label>
                <input type="number" id="car-year" name="year" min="1900" max="2025" required>
            </div>
            <div class="form-group">
                <label for="car-type">車型</label>
                <select id="car-type" name="type" required>
                    <option value="">選擇車型</option>
                    <option value="sedan">轎車</option>
                    <option value="luxury">豪華轎車</option>
                    <option value="suv">運動型多用途車/SUV</option>
                    <option value="mpv">多用途車/七人車</option>
                    <option value="mpv">旅行車</option>
                    <option value="coupe">跑車</option>
                    <option value="convertible">敞篷車</option>
                </select>
            </div>
            <div class="form-group">
                <label for="daily-rate">日租金</label>
                <input type="number" id="daily-rate" name="dailyRate" min="1" required>
            </div>
            <div class="form-group">
                <label for="car-seats">座位數</label>
                <input type="number" id="car-seats" name="seats" min="1" max="7" required>
            </div>
            <div class="form-group">
                <label for="car-transmission">變速系統</label>
                <select id="car-transmission" name="transmission" required>
                    <option value="">選擇變速系統</option>
                    <option value="automatic">自動</option>
                    <option value="manual">手動</option>
                </select>
            </div>
            <div class="form-group">
                <label for="car-power">動力來源</label>
                <select id="car-power" name="powerSource" required>
                    <option value="">選擇動力來源</option>
                    <option value="gasoline">汽油</option>
                    <option value="diesel">柴油</option>
                    <option value="electric">電動</option>
                    <option value="hybrid">油電混合</option>
                </select>
            </div>
            <div class="form-group">
                <label for="car-image">車輛照片</label>
                <input type="file" id="car-image" name="vehicleImage" accept="image/*" required>
            </div>
            <div class="form-group">
                <label for="car-description">車輛描述</label>
                <textarea id="car-description" name="description" rows="4"></textarea>
            </div>
            <div class="form-group">
                <label for="last-update">最後更新日期</label>
                <input type="date" id="last-update" name="lastUpDate" required>
            </div>
            <button type="submit" class="submit-button">添加車輛</button>
        </form>
    </main>

    <footer>
        <p>&copy; 2024 CarRental. All rights reserved.</p>
    </footer>
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const carID = urlParams.get('carID');

            if (carID) {
                try {
                    const res = await fetch(`/cars/edit1/${carID}`);
                    if (!res.ok) throw new Error('找不到車輛資料');
                    const car = await res.json();

                    document.getElementById('car-id').value = car.carID || '';
                    document.getElementById('car-brand').value = car.brand || '';
                    document.getElementById('car-model').value = car.model || '';
                    document.getElementById('car-year').value = car.year || '';
                    document.getElementById('car-type').value = car.type || '';
                    document.getElementById('daily-rate').value = car.dailyRate || '';
                    document.getElementById('car-seats').value = car.seats || '';
                    document.getElementById('car-transmission').value = car.transmission || '';
                    document.getElementById('car-power').value = car.powerSource || '';
                    document.getElementById('car-description').value = car.description || '';
                    document.getElementById('last-update').value = car.lastUpDate?.split('T')[0] || '';

                    document.querySelector('h1').textContent = '編輯車輛';
                    document.querySelector('.submit-button').textContent = '儲存修改';
                    document.getElementById('add-car-form').action = `/cars/update/${carID}`;
                } catch (err) {
                    alert('載入車輛資料失敗');
                    console.error(err);
                }
            }
        });
    </script>

</body>

</html>